# -*- coding: utf-8 -*-
'''
this file connects the spider and the view which
change class to dict or list,
this is unnecessary when 'mySpider.py' was changed to
return a list of Dict
----
use this again to connect to storage and keep server files seperated
----
2016-3-28
Don't store infomation to sql or storage, and use original url directly.
This file seems unnecessary now, just leave it waitting for other use.
'''
import mySpider

def getImgList(url):
    try:
        urlDictList = mySpider.getImg(url)
    except:
        urlDictList = [{'href': 'evandjango.sinaapp.com',
                        'src': '/static/images/noImage.jpg',
                        'description': 'no description'}]
<<<<<<< HEAD
=======
    storageUrl = u'http://6.evandjango.sinaapp.com/storageGet/'
    '''
    # try to stores at once, but failed
    srcList = []
    for each in urlDictList:
        srcList.append(each['src'])
    jsonSrcList = json.dumps(srcList)
    data =  {'urlDictList': jsonSrcList}
    encodeData = urllib.urlencode(data)
    req = urllib2.Request(storageUrl, encodeData)
    response = urllib2.urlopen(req)
    '''
        
    '''     # don't save images to storage in order to increase the speed
    # replace original_url with storage_url
    for each in urlDictList:
        try:    # if in mysql
            each['src'] = (imgstorage.objects.get(original_url = each['src'])).storage_url
        except:     # if not in mysql
            try:
                stUrl = urllib2.urlopen(storageUrl + each['src'])    # store images to storage
                each['src'] = (imgstorage.objects.get(original_url = each['src'])).storage_url
            except:
                print 'stores failed or get url from mysql failed'
                pass    # solve this later
    '''
>>>>>>> d9bba208158b8d7c195c4fbb7480a75d14c28e5a
    return urlDictList
